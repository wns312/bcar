## Todo
- [ ] sync-cars에서 차량 정보 중 제조사/모델, 차량 종류 등을 가져오는 것을 깜빡함. 관리자 페이지 크롤링시 같이 가져오면 된다.
- [ ] 환경 변수를 batch에 올리기 위해 jobDefinition을 재정의
  - Typescript + aws/sdk로 jobDefinition을 재정의하는 스크립트 작성(권장)
  - AWS Lambda에서 환경변수를 batch를 실행할때 넘겨준다
- [ ] Cronjob으로 지정된 시간에 batch를 실행하기 위한 Lambda 함수 정의
  - Serverless 사용 (권장)
    - 디렉토리를 어떻게 할지 결정
  - 직접 AWS Lambda 정의  
- [ ] 기능 개발
  - [ ] 모든 유저 정보에 대한 저장(보류: 최후로 미룰 것 -> 테스트 계정만 사용)
  - [ ] 차량 카테고리 코드 전부 정리해둘 것 (JSON? DynamoDB?)
  - [ ] 지역구 코드 전부 정리해둘 것
  - [ ] 지역구나 차량 카테고리에 해당하지 않는 차량에 대한 처리
  - [ ] 이미지 파일 링크를 통해 다운로드받는 로직 작성
    - [ ] 파일을 tmp 디렉토리에 임시로 저장한 뒤 즉시 활용할 것
  - [ ] 차량 한 대 등록 로직 작성
  - [ ] 차량 여러대 등록 로직 작성
  - [ ] 마감된 차량이나 판매중에서 내려간 차량을 걸러주는 로직과 차량 등록 로직을 분리 작성
  - [ ] 여러 사이트에 대한 통합 로직 추려내기
  - [ ] 모든 사이트 통합 로직으로 작성
  - [ ] Batch에서 에러 발생시 AWS SNS를 발송하도록 설정
    - [ ] 해당 로그 id나 식별자 id만 보내도록 할 것
    - [ ] 나머지를 로그로 많이 찍어둔다

## To think
### 1. 환경변수의 관리
우선 docker compose는 로컬에서 batch 실행에 대한 예측으로 활용한다고 보는편이 맞다.
따로 dotenv 패키지를 사용하지 않고, compose에게 env_file로 전달해주는 방식으로만 사용하고 있기 때문에 
source를 통한 일회성 import로 env를 사용하고 있다. (package.json의 스크립트를 통해 미리 작성)

따라서 환경변수를 AWS Batch의 JobDefinition에 추가해서 새로운 JobDefinition의 버전을 만들어주거나,
Batch의 실행마다 환경변수를 override해주는 방법이 있는데, 후자가 훨씬 번거롭다고 판단했기 때문에 (환경변수는 그렇게 자주 바뀌지 않을 것)
전자의 방법을 통해 구현하는 것이 적절하다고 판단하였다. 작성은 ts 파일로 진행할 예정

### 2. Batch의 지정된 시간의 실행 (스케쥴링)
EventBridge를 직접 다는 방법도 있는 것 같다. 
[ref](https://docs.aws.amazon.com/ko_kr/batch/latest/userguide/batch-cwe-target.html)
설정하기 까다롭거나 설정이 어렵다면 AWS Lambda+EventBrigde를 통한 스케쥴링을 설정한 후 추후 변경할 것

### 3. 차량 고르는 순서에 대한 정리
1. 차량 종류가 우선적으로 정해져 있어야 하는지, 아니면 제조사가 우선적으로 정해져 있어야 하는지가 중요할 것 같다.
2. 관리자 페이지에 차량 제목이 있는데, 이걸 띄어쓰기 다 제거 한 다음에, 제조사, 모델, 세부모델을 찾는 방향으로 가는게 좋다는 생각이 든다.
   1. 예를 들어 "기아 쏘울 부스터 EV EV 5인승 노블레스"가 제목인 경우
   2. "기아쏘울부스터EVEV5인승노블레스"로 문자열을 변경하고, 제조사인 "기아"를 찾는다.
   3. 그 다음에는 쏘울을 찾는다.
   4. 그 다음에는 세부모델에서 뒤에 괄호로 붙여진 년식을 빼고 검색한다. 예를 들면 쏘울부스터EV이다.
   5. 위에서 아래로 갈수록 이름이 간략해지므로 유효한 방법으로 보인다.
3. 차량 종류를 미리 가지고 있어도, 이름이 다를 수 있다
   1. 때문에 Category Crawler에서는 차량 사이즈 종류를 기준으로 분류하는 것이 아니라
   2. 제조사 -> 모델을 찾아갔을 때, 거기에서 차량 사이즈를 확인할 수 있도록 하는것이 괜찮아보인다.
   3. 모델만 알면 사이즈가 나오기 때문이다. 하지만 기타에 포함되는 경우에는 차량 사이즈가 또 다를 수 있다.
   4. 결국에는 미리 Categorize해놓아야 하는것은 명확한 것 같다. (결국 미리 차량을 크롤링해올 때, 교차로 포맷에 맞춰서 저장되어야 한다는 것을 의미한다.)
   5. 이 부분은 차량 사이즈에 대한 부분만이므로, 차량 사이즈와 차량에 대한 제목만 추가로 저장하고,
   6. 차량 사이즈는 교차로의 포맷에 맞게 저장하도록 한다. 그리고 수입차와 외제차를 구분해서 저장해야 한다.
   7. 천천히 하자..
